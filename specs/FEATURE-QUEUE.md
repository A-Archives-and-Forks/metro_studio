# Metro Studio — Feature Queue

> 基于 v0.44.0 代码库分析生成，按优先级排序。

---

## 新功能建议

### P0 — 工程导出为 SVG 矢量图

- **产品描述**：支持将示意图导出为可编辑的 SVG 矢量格式，满足印刷和二次编辑需求。
- **背景 & 依据**：当前仅支持 PNG 位图导出（`src/lib/export/exportSchematic.js`），用户无法在 Illustrator/Inkscape 中二次编辑，也无法无损缩放用于大幅面印刷。
- **预期影响**：高
- **实现复杂度**：中
- **验收标准**：
  1. 示意图视图可一键导出 SVG 文件
  2. SVG 中线路、站点、标签为独立可编辑元素
  3. 导出文件在主流矢量编辑器中可正常打开

---

### P0 — 工程云端同步 / 分享链接

- **产品描述**：支持将工程生成分享链接，他人可通过链接查看或导入工程。
- **背景 & 依据**：当前数据仅存储在 IndexedDB（`src/lib/storage/db.js`），换设备或清除浏览器数据即丢失。导出 JSON 再手动传输的流程摩擦大。
- **预期影响**：高
- **实现复杂度**：高
- **验收标准**：
  1. 用户可生成工程分享链接（含只读/可编辑权限）
  2. 他人通过链接可在浏览器中直接查看线网图
  3. 支持从分享链接一键导入到本地工程列表

---

### P1 — 站点/线路搜索与快速跳转

- **产品描述**：在地图编辑器中提供全局搜索框，可按站名/线路名模糊搜索并跳转定位。
- **背景 & 依据**：当前 `MapSearchDialog`（`src/components/MapSearchDialog.vue`）仅支持 OSM 地名搜索，无法搜索工程内已有的站点和线路。大型线网（100+ 站）中定位特定站点效率低。
- **预期影响**：高
- **实现复杂度**：低
- **验收标准**：
  1. 快捷键唤起搜索框，支持站名/线路名模糊匹配
  2. 选中结果后地图自动平移缩放至目标位置
  3. 搜索结果高亮显示匹配的站点/线路

---

### P1 — 多工程对比视图

- **产品描述**：支持同时打开两个工程进行左右对比，便于方案比选。
- **背景 & 依据**：城市轨道交通规划常需对比不同方案。当前只能单工程操作（`src/App.vue` 中 `hasActiveProject` 为单一 computed），用户需反复切换工程。
- **预期影响**：中
- **实现复杂度**：高
- **验收标准**：
  1. 可从工程列表选择两个工程进入对比模式
  2. 左右分屏同步缩放/平移
  3. 统计面板显示两个工程的差异数据

---

### P2 — 线路里程自动统计与断面客流标注

- **产品描述**：自动计算每条线路总里程、平均站间距，并支持在边上标注客流数据。
- **背景 & 依据**：`RailEdge` 已有 `lengthMeters` 字段（`src/lib/projectModel.js:28`），`networkStatistics.js` 已有基础统计，但缺少线路维度的里程汇总和客流标注能力。
- **预期影响**：中
- **实现复杂度**：低
- **验收标准**：
  1. 统计面板显示每条线路的总里程和平均站间距
  2. 边属性面板支持输入客流数据
  3. 地图上可选择性显示客流标注

---

### P2 — 键盘无障碍与屏幕阅读器支持

- **产品描述**：完善键盘导航和 ARIA 标注，使视障用户可操作核心功能。
- **背景 & 依据**：CLAUDE.md 明确要求"Canvas 绘制的文字内容必须在 DOM 中有对应的隐藏文本层"，但当前 `TimelinePreviewView` 和 `VehicleHudView` 的 Canvas 内容缺少对应的无障碍文本层。`SchematicView` 的 SVG 输出也缺少 ARIA role。
- **预期影响**：中
- **实现复杂度**：中
- **验收标准**：
  1. 所有 Canvas 视图有对应的 `aria-label` 或隐藏文本层
  2. 工具栏、菜单栏可完全通过键盘 Tab/Enter 操作
  3. 屏幕阅读器可朗读当前选中站点/线路信息

---

### P3 — 工程模板库

- **产品描述**：提供预置工程模板（如"环线+放射线"、"棋盘网格"），新建工程时可选择模板快速起步。
- **背景 & 依据**：`createEmptyProject()`（`src/lib/projectModel.js:66`）只创建空白工程含一条默认线路。新用户从零开始绘制门槛高，预置模板可降低上手成本。
- **预期影响**：低
- **实现复杂度**：低
- **验收标准**：
  1. 新建工程对话框提供至少 3 个预置模板
  2. 选择模板后自动生成对应拓扑结构
  3. 模板工程可正常编辑和保存

---

## 改进建议

### P0 — 自动保存间隔过长 & 无保存失败恢复

- **产品描述**：将自动保存间隔从 30 秒缩短，并增加保存失败时的重试和用户提示。
- **背景 & 依据**：`useAutoSave.js` 中 `DEBOUNCE_MS = 30_000`，30 秒内的编辑在浏览器崩溃时会丢失。保存失败时仅设置 `saveState = 'error'`（第 52 行），无重试逻辑，用户可能不会注意到状态栏的错误提示。
- **预期影响**：高
- **实现复杂度**：低
- **验收标准**：
  1. 自动保存间隔缩短至 5-10 秒
  2. 保存失败时自动重试（最多 3 次，指数退避）
  3. 连续失败后弹出显眼的 Toast 提示用户手动保存

---

### P0 — 大型线网性能优化

- **产品描述**：优化 100+ 站点线网的编辑和渲染性能，减少卡顿。
- **背景 & 依据**：`useAutoSave.js` 对 `store.project` 使用 `{ deep: true }` 深度监听（第 87 行），大型工程每次微小变更都会触发完整的深度比较。`projectStore` 的 undo 历史保留 320 条快照，大型工程内存占用可观。`listProjectsFromDb()` 一次性加载所有工程并逐一 `normalizeProject()`（`db.js:176-180`）。
- **预期影响**：高
- **实现复杂度**：中
- **验收标准**：
  1. 200 站线网编辑操作响应时间 < 100ms
  2. 工程列表加载采用分页或虚拟滚动
  3. Undo 历史采用增量快照而非全量复制

---

### P1 — OSM 导入错误处理与进度反馈

- **产品描述**：OSM 导入过程增加详细进度条和错误恢复能力。
- **背景 & 依据**：`genericImporter.js` 通过 Overpass API 拉取数据，网络超时或 API 限流时用户只能看到 `statusText` 的简短提示。导入 50+ 城市预设（`cityPresets.js` 含 57 个城市）时无法预知耗时，也无法中断。
- **预期影响**：中
- **实现复杂度**：低
- **验收标准**：
  1. 导入过程显示分步进度（下载数据 → 解析拓扑 → 生成线路）
  2. 网络错误时提供重试按钮
  3. 支持取消正在进行的导入操作

---

### P1 — 示意图布局算法稳定性

- **产品描述**：提升自动布局的确定性和可控性，减少"每次结果不同"的困扰。
- **背景 & 依据**：`src/workers/layout/` 中的力导向布局算法包含随机初始化（`optimizeLayout.js`），同一线网多次布局结果不一致。`forces.js` 和 `constraints.js` 的参数调优缺少用户可控的预设。
- **预期影响**：中
- **实现复杂度**：中
- **验收标准**：
  1. 提供"锁定种子"选项，相同输入产生相同布局
  2. 提供 2-3 个布局风格预设（紧凑/宽松/地理保真）
  3. 支持手动固定部分站点位置后重新布局

---

### P2 — 快捷键冲突检测与可视化

- **产品描述**：快捷键设置面板增加冲突检测和当前绑定的可视化展示。
- **背景 & 依据**：`ShortcutSettingsDialog.vue` 允许自定义快捷键，但 `shortcutRegistry.js` 未实现冲突检测。用户可能将同一组合键绑定到多个操作而不自知。
- **预期影响**：低
- **实现复杂度**：低
- **验收标准**：
  1. 绑定快捷键时实时检测冲突并高亮提示
  2. 提供"恢复默认"按钮
  3. 快捷键列表按功能分组展示

---

### P2 — 深色/浅色主题切换

- **产品描述**：提供用户可切换的深色/浅色主题，当前仅有深色 Arknights 风格。
- **背景 & 依据**：`naiveTheme.js` 配置了 Naive UI 的暗色主题，`style.css` 中 CSS 变量以深色为基准。部分用户在明亮环境下使用时对比度不足，且导出的示意图背景为深色，不适合嵌入浅色背景的文档。
- **预期影响**：中
- **实现复杂度**：中
- **验收标准**：
  1. 菜单栏提供主题切换入口
  2. 浅色主题下所有 UI 元素可读性良好
  3. 导出图片可选择深色/浅色背景

---

### P3 — 移动端只读查看模式

- **产品描述**：在移动端提供只读查看模式，支持手势缩放和平移浏览线网图。
- **背景 & 依据**：`App.vue` 在 `<768px` 时完全隐藏应用（`.unsupported-screen`），显示"请在桌面浏览器中访问"。分享链接场景下，接收者很可能在手机上打开。
- **预期影响**：中
- **实现复杂度**：高
- **验收标准**：
  1. 移动端可查看线网地图和示意图（只读）
  2. 支持双指缩放和单指平移
  3. 点击站点可查看站名和所属线路
